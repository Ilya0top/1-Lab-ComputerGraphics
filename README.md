# Коррекция теней и светов изображения

Реализация профессионального алгоритма коррекции теней и светов изображения с использованием цветового пространства Lab.

## О проекте

Проект реализует алгоритм коррекции изображений, аналогичный функции "Shadows/Highlights" в Adobe Photoshop. Основные особенности:

- Работа в цветовом пространстве Lab для сохранения цветового баланса
- Независимая коррекция теней и светов
- Использование масок с гауссовым размытием для естественных результатов
- Настройка силы коррекции, тональной ширины и радиуса размытия

## Архитектура проекта

### Основные классы:

#### 1. `ColorConverter`
- **Назначение**: Конвертация между цветовыми пространствами BGR и Lab
- **Методы**:
  - `BGR2Lab()` - преобразование BGR → Lab
  - `Lab2BGR()` - преобразование Lab → BGR
  - Вспомогательные методы для преобразований RGB↔XYZ↔Lab

#### 2. `LabImageProcessor`
- **Назначение**: Работа с каналами Lab изображений
- **Методы**:
  - `splitLab()` - разделение на каналы L, a, b
  - `mergeLab()` - объединение каналов в Lab изображение

#### 3. `ShadowHighlightsFilter` (основной класс)
- **Назначение**: Применение коррекции теней и светов
- **Параметры**:
  - `shadowAmount` (0.0-1.0) - сила осветления теней
  - `highlightAmount` (0.0-1.0) - сила затемнения светов  
  - `tonalWidth` (0.0-1.0) - тональная ширина коррекции
  - `blurRadius` (0.0-50.0) - радиус размытия масок

#### 4. `TestRunner`
- **Назначение**: Комплексное тестирование и визуализация результатов
- **Функциональность**:
  - Автоматическое тестирование с разными параметрами
  - Сравнительный анализ пикселей
  - Создание мозаики для визуального сравнения
  - Сохранение результатов в папку `ImageResult/`

## Быстрый старт

### Требования
- OpenCV 4.x
- C++17 compatible compiler
- Visual Studio 2022 (рекомендуется)

### Запуск

1. **Подготовка изображений**:
   - Поместите исходное изображение в папку `Image/original.jpg`

2. **Сборка и запуск**:
   ```bash
   # Откройте решение в Visual Studio
   ComputerGraphic.sln
   # Соберите и запустите проект

3. **Просмотр результатов**:
   - Результаты автоматически сохраняются в папку `ImageResult/`
   - Открывается окно с визуальным сравнением различных настроек

## Использование

### Базовое применение

```cpp
#include "ShadowHighlightsFilter.h"

// Загрузка изображения
cv::Mat image = cv::imread("input.jpg");

// Создание фильтра с параметрами (тени, света, ширина, радиус)
ShadowHighlightsFilter filter(0.3f, 0.2f, 0.5f, 15.0f);

// Применение фильтра
cv::Mat result = filter.apply(image);

// Расширенная настройка

ShadowHighlightsFilter filter;

// Поэтапная настройка параметров
filter.setShadowAmount(0.4f);      // Осветление теней 40%
filter.setHighlightAmount(0.3f);   // Затемнение светов 30%  
filter.setTonalWidth(0.6f);        // Широкая тональная коррекция
filter.setBlurRadius(20.0f);       // Сильное размытие масок

// Просмотр текущих настроек
filter.printCurrentSettings();
```

### Пример результатов

Проект автоматически тестирует 4 варианта коррекции:

1. Только тени (50%) - осветление темных областей
2. Только света (40%) - затемнение ярких областей
3. Комбинированно (30%/20%) - сбалансированная коррекция
4. Сильная коррекция (70%/50%) - агрессивная обработка

## Структурапроекта

```
ComputerGraphic/
├── Image/                 	# Исходные изображения
├── ImageResult/           	# Результаты обработки
├── ColorConverter.h       	# Конвертер цветовых пространств
├── LabImageProcessor.h    	# Обработчик Lab каналов
├── ShadowHighlightsFilter.h 	# Основной класс фильтра
├── TestRunner.h           	# Тестирование и визуализация
└── Main.cpp              	# Точка входа
```

## Технические детали

### Алгоритм работы:

1. Конвертация BGR → Lab - переход в перцептивно uniform пространство
2. Разделение каналов - выделение яркости (L) и цветности (a, b)
3. Создание масок - генерация масок теней и светов с плавными переходами
4. Коррекция яркости - применение масок к каналу L
5. Объединение и конвертация - Lab → BGR с сохранением цветового баланса

###  Особенности реализации:

   - Адаптивные пороги - автоматическая настройка на основе тональной ширины
   - Многопроходное размытие - оптимизированное гауссово размытие масок
   - Защита от артефактов - ограничение минимальных/максимальных значений
   - Обработка границ - корректная обработка краев изображения

##  Примечания

   - Для лучших результатов используйте изображения в высоком качестве
   - Рекомендуемые значения параметров: 0.2-0.4 для теней/светов
   - Большие значения `blurRadius` (>30) значительно увеличивают время обработки
   - Проект включает comprehensive тестирование для анализа эффективности алгоритма

